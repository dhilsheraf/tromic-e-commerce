<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Nest Dashboard</title>
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="" />
  <meta property="og:type" content="" />
  <meta property="og:url" content="" />
  <meta property="og:image" content="" />
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/assets/imgs/theme/favicon.svg" />
  <!-- Template CSS -->
  <link href="/assets/css/main.css?v=1.1" rel="stylesheet" type="text/css" />
</head>
<style>
  .filter-options {
    margin-bottom: 20px;
    display: flex;
    gap: 20px;
    align-items: center;
    justify-content: space-between;
    padding: 10px 15px;
    background-color: #f7f7f7;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  .filter-options label {
    font-weight: 600;
    font-size: 16px;
    color: #333;
  }

  .filter-options select,
  .filter-options input[type="date"] {
    padding: 8px 15px;
    font-size: 14px;
    border: 1px solid #ddd;
    border-radius: 6px;
    transition: all 0.3s ease;
  }

  .filter-options select:focus,
  .filter-options input[type="date"]:focus {
    border-color: #5f75e0;
    outline: none;
  }

  .filter-options button {
    padding: 8px 20px;
    background-color: rgba(32, 111, 111, 0.932);
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .filter-options button:hover {
    background-color: rgb(0, 255, 0);
  }

  .filter-options .quick-filter {
    display: flex;
    gap: 20px;
    align-items: center;
  }

  .filter-options .quick-filter select {
    font-weight: 600;
    padding: 6px 15px;
    border-radius: 6px;
    background-color: #f1f1f1;
    border: 1px solid #ccc;
  }

  .filter-options .quick-filter select:hover {
    border-color: #5f75e0;
  }

  .filter-options .quick-filter select:focus {
    border-color: #5f75e0;
    outline: none;
  }

  .card-body {
    padding: 25px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }

  .card-body .card-title {
    font-size: 20px;
    font-weight: 700;
    color: #333;
    margin-bottom: 15px;
  }

  .d-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  .d-flex label {
    font-size: 16px;
  }

  /* Radio Button Styling */
  input[type="radio"] {
    margin-right: 8px;
    transform: scale(1.2);
  }

  input[type="radio"]:checked {
    accent-color: #5f75e0;
  }
</style>

<body>
  <div class="screen-overlay"></div>
  <aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top">
      <a href="/admin/dashboard" class="brand-wrap">
        <img src="/assets/imgs/theme/logo.svg" class="logo" alt="Nest Dashboard" />
      </a>
      <div>
        <button class="btn btn-icon btn-aside-minimize">
          <i class="text-muted material-icons md-menu_open"></i>
        </button>
      </div>
    </div>
    <nav>
      <ul class="menu-aside">
        <li class="menu-item active">
          <a class="menu-link" href="/admin/dashboard">
            <i class="icon material-icons md-home"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/users">
            <i class="icon material-icons md-person"></i>
            <span class="text">Users</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/products">
            <i class="icon material-icons md-add_box"></i>
            <span class="text">Products</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/category">
            <i class="icon material-icons md-store"></i>
            <span class="text">Category</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/orders">
            <i class="icon material-icons md-shopping_cart"></i>
            <span class="text">Orders</span>
          </a>
        </li>
        <li class="menu-item ">
          <a class="menu-link" href="/admin/offer">
            <i class="icon material-icons md-monetization_on"></i>
            <span class="text">Offer</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/coupon">
            <i class="icon material-icons md-stars">
            </i> <span class="text">Coupons</span> </a>
        </li>
      </ul>
    </nav>
  </aside>
  <main class="main-wrap">
    <header class="main-header navbar">

      <div class="col-nav">
        <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside">
          <i class="material-icons md-apps"></i>
        </button>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link btn-icon darkmode" href="#">
              <i class="material-icons md-nights_stay"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="requestfullscreen nav-link btn-icon"><i class="material-icons md-cast"></i></a>
          </li>


        </ul>
      </div>
    </header>
    <section class="content-main">
      <div class="content-header">
        <div>
          <h2 class="content-title card-title">Dashboard</h2>
          <p>Whole data about your business here</p>
        </div>
        <div>
          <a href="/admin/sales-report" class="btn btn-primary"><i
              class="text-muted material-icons md-post_add"></i>Sales report</a>
        </div>
        <div>
          <a href="/admin/logout" class="btn btn-primary">logout</a>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-3">
          <div class="card card-body mb-4">
            <article class="icontext">
              <span class="icon icon-sm rounded-circle bg-primary-light"><i
                  class="text-primary material-icons md-monetization_on"></i></span>
              <div class="text">
                <h6 class="mb-1 card-title">Revenue</h6>
                <span>₹ <%= revenue[0].total %>
                </span>
                <span class="text-sm"> Shipping fees are not included </span>
              </div>
            </article>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="card card-body mb-4">
            <article class="icontext">
              <span class="icon icon-sm rounded-circle bg-success-light"><i
                  class="text-success material-icons md-local_shipping"></i></span>
              <div class="text">
                <h6 class="mb-1 card-title">Orders</h6>
                <span>
                  <%= totalOrder %>
                </span>
                <span class="text-sm"> Excluding orders in transit </span>
              </div>
            </article>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="card card-body mb-4">
            <article class="icontext">
              <span class="icon icon-sm rounded-circle bg-warning-light"><i
                  class="text-warning material-icons md-qr_code"></i></span>
              <div class="text">
                <h6 class="mb-1 card-title">Products</h6>
                <span>
                  <%= products %>
                </span>
                <span class="text-sm"> In <%= categorys%> Categories </span>
              </div>
            </article>
          </div>
        </div>
        <div class="col-lg-3">
          <div class="card card-body mb-4">
            <article class="icontext">
              <span class="icon icon-sm rounded-circle bg-info-light"><i
                  class="text-info material-icons md-shopping_basket"></i></span>
              <div class="text">
                <h6 class="mb-1 card-title">Monthly Earning</h6>
                <span>₹ <%=monthly%></span>
                <span class="text-sm"> Based in your local time. </span>
              </div>
            </article>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Filter Section -->
        <div class="col-lg-12">
          <div class="card mb-4">
            <article class="card-body">

              <div class="filter-options">
                <div class="quick-filter">
                  <label for="timeRangeFilter">Quick Filter:</label>
                  <select id="timeRangeFilter">
                    <option value="7">Last 1 Week</option>
                    <option value="30">Last 1 Month</option>
                    <option value="365">Last 1 Year</option>
                    <option value="Custom">Custom</option>
                  </select>
                </div>

                <div class="custom-filter">
                  <label for="customFilter">Custom Filter:</label>
                  <input type="date" id="startDate" placeholder="Start Date" />
                  <input type="date" id="endDate" placeholder="End Date" />
                  <button id="submitButton">Apply Filter</button>
                </div>
              </div>

              <div class="d-flex justify-content-between">
                <h5 class="card-title">Top 10 </h5>
                <div>
                  <label>
                    <input type="radio" name="dataToggle" value="products" checked /> Products
                  </label>
                  <label>
                    <input type="radio" name="dataToggle" value="categories" /> Categories
                  </label>
                </div>
              </div>

              <canvas id="dynamicChart" height="150px"></canvas>
            </article>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="main-footer font-xs">
    <div class="row pb-30 pt-15">
      <div class="col-sm-6">
        <script>
          document.write(new Date().getFullYear());
        </script>
        &copy; Nest - HTML Ecommerce Template .
      </div>
      <div class="col-sm-6">
        <div class="text-sm-end">All rights reserved</div>
      </div>
    </div>
  </footer>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    const salesData = {
      productLabels: [],
      productSales: [],
      categoryLabels: [],
      categorySales: []
    };
  
    let chartType = 'products';
    let dynamicChart;
  
    document.addEventListener('DOMContentLoaded', () => {
      initializeChart();
      fetchFilteredData('7', null, null); 
  
      const timeRangeFilter = document.getElementById('timeRangeFilter');
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');
      const submitButton = document.getElementById('submitButton');
      const customFilterInputs = document.querySelector('.custom-filter');
  
      customFilterInputs.style.display = 'none';
  
      timeRangeFilter.addEventListener('change', () => {
        if (timeRangeFilter.value === 'Custom') {
          customFilterInputs.style.display = 'flex';
        } else {
          customFilterInputs.style.display = 'none';
          fetchFilteredData(timeRangeFilter.value, null, null);
        }
      });
  
      submitButton.addEventListener('click', () => {
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
  
        if (startDate && endDate) {
          fetchFilteredData(null, startDate, endDate);
        } else {
          Swal.fire('Please select both start and end dates.');
        }
      });
  
      document.querySelectorAll('input[name="dataToggle"]').forEach(radio => {
        radio.addEventListener('change', function () {
          chartType = this.value;
          updateChart();
        });
      });
    });
  
    function initializeChart() {
      const ctx = document.getElementById('dynamicChart').getContext('2d');
      dynamicChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: salesData.productLabels,
          datasets: [
            {
              label: 'Top Selling Products',
              data: salesData.productSales,
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            },
            tooltip: {
              callbacks: {
                label: function (context) {
                  return `${context.dataset.label}: ${context.raw}`;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(200, 200, 200, 0.3)'
              }
            }
          }
        }
      });
    }
  
    async function fetchFilteredData(timeRange, startDate, endDate) {
      try {
        const response = await fetch('/admin/graph', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ timeRange, startDate, endDate })
        });
  
        const data = await response.json();
  
        salesData.productLabels = data.productLabels || [];
        salesData.productSales = data.productSales || [];
        salesData.categoryLabels = data.categoryLabels || [];
        salesData.categorySales = data.categorySales || [];
  
        updateChart();
      } catch (error) {
        console.error('Error fetching filtered data:', error);
      }
    }
  
    function updateChart() {
      if (chartType === 'products') {
        dynamicChart.data.labels = salesData.productLabels;
        dynamicChart.data.datasets[0].data = salesData.productSales;
        dynamicChart.data.datasets[0].label = 'Top Selling Products';
        dynamicChart.data.datasets[0].backgroundColor = 'rgba(75, 192, 192, 0.2)';
        dynamicChart.data.datasets[0].borderColor = 'rgba(75, 192, 192, 1)';
      } else if (chartType === 'categories') {
        dynamicChart.data.labels = salesData.categoryLabels;
        dynamicChart.data.datasets[0].data = salesData.categorySales;
        dynamicChart.data.datasets[0].label = 'Top Selling Categories';
        dynamicChart.data.datasets[0].backgroundColor = 'rgba(153, 102, 255, 0.2)';
        dynamicChart.data.datasets[0].borderColor = 'rgba(153, 102, 255, 1)';
      }
      dynamicChart.update();
    }
  </script>
  

  <script src="/assets/js/vendors/jquery-3.6.0.min.js"></script>
  <script src="/assets/js/vendors/bootstrap.bundle.min.js"></script>
  <script src="/assets/js/vendors/select2.min.js"></script>
  <script src="/assets/js/vendors/perfect-scrollbar.js"></script>
  <script src="/assets/js/vendors/jquery.fullscreen.min.js"></script>
  <!-- <script src="/assets/js/vendors/chart.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Main Script -->
  <script src="/assets/js/main.js?v=1.1" type="text/javascript"></script>
  <script src="/assets/js/custom-chart.js" type="text/javascript"></script>
</body>

</html>